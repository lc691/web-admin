{% extends "base.html" %}
{% block content %}
<h1 class="h3 mb-2 text-gray-800">{{ title }}</h1>

<!-- Table -->
<div class="card shadow mb-4">
  <div class="card-body table-responsive">
      <table id="userTable" class="table table-bordered" width="100%" cellspacing="0">
      <thead>
        <tr>
          {% if users %}
            {% for col in users[0].keys() %}
              <th>{{ col }}</th>
            {% endfor %}
            <th>Aksi</th>
          {% else %}
            <th colspan="100%">Tidak ada data</th>
          {% endif %}
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
          <tr>
            {% for val in user.values() %}
              <td>{{ val }}</td>
            {% endfor %}
            <td>
              <a href="/users/{{ user['id'] }}/edit" class="btn btn-warning btn-circle btn-sm" title="Edit">
                <i class="fas fa-pencil-alt"></i>
              </a>
              <button type="button" class="btn btn-danger btn-circle btn-sm"
                      data-toggle="modal"
                      data-target="#deleteModal"
                      data-userid="{{ user['id'] }}"
                      title="Hapus">
                <i class="fas fa-trash-alt"></i>
              </button>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Modal Hapus -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <form method="post" action="" id="deleteForm">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteModalLabel">Konfirmasi Hapus</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Tutup">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Anda yakin ingin menghapus pengguna ini?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Batal</button>
          <button type="submit" class="btn btn-danger">Hapus</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Script untuk set action delete -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const deleteModal = document.getElementById('deleteModal');
    deleteModal.addEventListener('show.bs.modal', function (event) {
      const button = event.relatedTarget;
      const userId = button.getAttribute('data-userid');
      const form = document.getElementById('deleteForm');
      form.action = `/users/${userId}/delete`;
    });
  });
</script>

{% endblock %}

{% block scripts %}
<script>
  $(document).ready(function () {
    $('#userTable').DataTable({
      "language": {
        "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/id.json"
      },
      "ordering": true,
      "paging": true,
      "info": true,
      "autoWidth": false,
      "lengthChange": true,
      "pageLength": 10
    });
  });
</script>
{% endblock %}
