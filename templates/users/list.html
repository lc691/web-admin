{% extends "base.html" %}

{% block content %}
<h1 class="h3 mb-3 text-gray-800">{{ title }}</h1>

<div class="card shadow mb-4">
    <div class="card-body table-responsive">

        <table id="userTable" class="table table-bordered table-hover" width="100%">
            <thead class="thead-light">
                <tr>
                    <th>ID</th>
                    <th>User ID</th>
                    <th>Username</th>
                    <th>Nama</th>
                    <th>VIP</th>
                    <th>VIP Expired</th>
                    <th>VIP Purchases</th>
                    <th>Status</th>
                    <th>Dibuat</th>
                    <th>Aksi</th>
                </tr>
            </thead>

            <tbody>
                {% for u in users %}
                <tr>
                    <td>{{ u.id }}</td>
                    <td>{{ u.user_id }}</td>
                    <td>{{ u.username or "-" }}</td>
                    <td>{{ u.first_name or "-" }}</td>

                    <!-- VIP Status -->
                    <td class="text-center">
                        <span class="badge badge-{{ 'success' if u.is_vip else 'secondary' }}">
                            {{ 'VIP' if u.is_vip else 'No' }}
                        </span>
                    </td>

                    <!-- VIP Expired -->
                    <td>{{ u.vip_expired.strftime('%Y-%m-%d %H:%M') if u.vip_expired else '-' }}</td>

                    <!-- VIP Purchases -->
                    <td class="text-center">
                        <span class="badge badge-info">
                            {{ u.total_purchases }}
                        </span>
                    </td>

                    <!-- Active Status -->
                    <td class="text-center">
                        <span class="badge badge-{{ 'primary' if u.is_active else 'danger' }}">
                            {{ 'Aktif' if u.is_active else 'Nonaktif' }}
                        </span>
                    </td>

                    <!-- Created At -->
                    <td>{{ u.created_at.strftime('%Y-%m-%d %H:%M') if u.created_at else '-' }}</td>

                    <!-- Action -->
                    <td class="text-center">
                        <a href="/users/{{ u.id }}/edit" class="btn btn-warning btn-sm">
                            <i class="fas fa-pencil-alt"></i>
                        </a>
                        <button class="btn btn-danger btn-sm" data-toggle="modal" data-target="#deleteModal"
                            data-userid="{{ u.id }}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>

        </table>

    </div>
</div>

<!-- DELETE MODAL -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <form method="post" id="deleteForm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Konfirmasi Hapus</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    Yakin ingin menghapus user ini?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Batal</button>
                    <button type="submit" class="btn btn-danger">Hapus</button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}


{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {

        $('#userTable').DataTable({
            paging: true,
            searching: true,
            info: true,
            pageLength: 10,
            lengthMenu: [10, 25, 50],
            order: [[0, 'desc']],
            language: {
                search: "Cari:",
                lengthMenu: "Tampilkan _MENU_",
                info: "Menampilkan _START_–_END_ dari _TOTAL_",
                zeroRecords: "Data tidak ditemukan",
                paginate: {
                    previous: "‹",
                    next: "›"
                }
            }
        });

        // tooltip
        $('[data-toggle="tooltip"]').tooltip();

        // delete modal
        $('#deleteModal').on('show.bs.modal', function (e) {
            const userId = $(e.relatedTarget).data('userid');
            $('#deleteForm').attr('action', `/users/${userId}/delete`);
        });

    });
</script>
{% endblock %}