{% extends "base.html" %}
{% block content %}

<div class="card shadow mb-4">

    <!-- ========================= -->
    <!-- TITLE -->
    <!-- ========================= -->
    <div class="card-header py-3">
        <h5 class="m-0 font-weight-bold text-primary">{{ title }}</h5>
    </div>

    <div class="card-body">

        {% if referrer_user_id %}
        <div class="alert alert-info">
            Referrer ID: <b>{{ referrer_user_id }}</b>
        </div>
        {% endif %}

        {% if referred_user_id %}
        <div class="alert alert-info">
            Referred User ID: <b>{{ referred_user_id }}</b>
        </div>
        {% endif %}

        {% if vip_package_name %}
        <div class="alert alert-info">
            Paket VIP: <b>{{ vip_package_name }}</b>
        </div>
        {% endif %}

        <!-- ========================= -->
        <!-- TABLE -->
        <!-- ========================= -->
        <div class="table-responsive">
            <table id="affiliateTable" class="table table-bordered table-hover" width="100%">
                <thead class="thead-light">
                    <tr>
                        <th>#</th>
                        <th>Waktu</th>
                        <th>Referrer</th>
                        <th>User</th>
                        <th>Paket</th>
                        <th>Harga</th>
                        <th>Komisi</th>
                    </tr>
                </thead>
                <tbody>

                    {% for tx in transactions %}
                    <tr>
                        <td>{{ loop.index }}</td>

                        <td>
                            {{ tx.created_at.strftime("%d-%m-%Y %H:%M") }}
                        </td>

                        <td>
                            <a href="/affiliate/transactions/referrer/{{ tx.referrer_user_id }}">
                                {{ tx.referrer_user_id }}
                            </a>
                        </td>

                        <td>
                            <a href="/affiliate/transactions/referred/{{ tx.referred_user_id }}">
                                {{ tx.referred_user_id }}
                            </a>
                        </td>

                        <td>
                            <a href="/affiliate/transactions/package/{{ tx.paket }}">
                                {{ tx.paket }}
                            </a>
                        </td>

                        <td>
                            Rp {{ "{:,.0f}".format(tx.price).replace(",", ".") }}
                        </td>

                        <td class="fw-bold text-success">
                            Rp {{ "{:,.0f}".format(tx.commission).replace(",", ".") }}
                        </td>
                    </tr>
                    {% endfor %}

                </tbody>
            </table>
        </div>

    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {

        $('#affiliateTable').DataTable({
            paging: true,
            searching: true,
            info: true,
            pageLength: 10,
            lengthMenu: [10, 25, 50],
            order: [[1, 'desc']],
            language: {
                search: "Cari:",
                lengthMenu: "Tampilkan _MENU_",
                info: "Menampilkan _START_–_END_ dari _TOTAL_",
                zeroRecords: "Data tidak ditemukan",
                paginate: {
                    previous: "‹",
                    next: "›"
                }
            }
        });

    });
</script>
{% endblock %}